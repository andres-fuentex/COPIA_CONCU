<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bogot√° Visible - Gemelo Digital</title>
    
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <style>
        body, html { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: 'Helvetica', sans-serif; background-color: #000; }
        #cesiumContainer { width: 100%; height: 100%; }
        
        /* Panel Flotante */
        #uiPanel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(20, 10, 30, 0.95); /* Tono oscuro ros√°ceo */
            color: #eee;
            padding: 20px;
            border-radius: 12px;
            border-left: 6px solid #FF69B4; /* Borde Rosa */
            z-index: 999;
            width: 260px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }
        h2 { margin: 0 0 15px 0; font-size: 18px; color: #fff; }
        p { margin: 8px 0; font-size: 14px; color: #ccc; }
        .dato { font-weight: bold; color: #FF69B4; font-size: 15px; } /* Texto Rosa */
        .footer { margin-top: 15px; border-top: 1px solid #444; padding-top: 10px; font-size: 11px; color: #888; }
    </style>
</head>
<body>

    <div id="cesiumContainer"></div>

    <div id="uiPanel">
        <h2 id="titulo">üìç Cargando datos...</h2>
        <p>Radio: <span id="lblRadio" class="dato">--</span> m</p>
        <p>Lat: <span id="lblLat" class="dato">--</span></p>
        <p>Lon: <span id="lblLon" class="dato">--</span></p>
        <div class="footer">Gemelo Digital 2025 ‚Ä¢ Cesium Ion</div>
    </div>

    <script>
        // üîë TOKEN CONFIGURADO
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3NmY0NDc1NS0wNTI1LTQ5MzktODU4Yi04MzEyZDBhNGQ1OGMiLCJpZCI6MzY3NDIwLCJpYXQiOjE3NjUxMjUyNzJ9.rNorYTcXLUMNiocHyuT9VPqrMUdC6yHvbKq8kW-PVds'; 

        const params = new URLSearchParams(window.location.search);
        const lat = parseFloat(params.get('lat')) || 4.5981;
        const lon = parseFloat(params.get('lon')) || -74.0760;
        const radio = parseFloat(params.get('radio')) || 500;
        const localidad = params.get('loc') || "Bogot√° D.C.";

        // Actualizar UI
        document.getElementById('titulo').innerText = `üìç ${localidad}`;
        document.getElementById('lblRadio').innerText = radio;
        document.getElementById('lblLat').innerText = lat.toFixed(4);
        document.getElementById('lblLon').innerText = lon.toFixed(4);

        async function iniciarCesium() {
            try {
                const viewer = new Cesium.Viewer('cesiumContainer', {
                    terrain: Cesium.Terrain.fromWorldTerrain(), 
                    animation: false,
                    timeline: false,
                    baseLayerPicker: true, 
                    fullscreenButton: false,
                    homeButton: false,
                    infoBox: false,
                    selectionIndicator: false,
                    sceneModePicker: false,
                    navigationHelpButton: false,
                    geocoder: false,
                    creditContainer: document.createElement("div")
                });

                

                // ============================================================
                // CORRECCI√ìN: RADIO ROSA SOBRE TERRENO
                // ============================================================
                viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(lon, lat),
                    ellipse: {
                        semiMinorAxis: radio,
                        semiMajorAxis: radio,
                        // Color Rosa (HotPink) con transparencia
                        material: Cesium.Color.HOTPINK.withAlpha(0.3),
                        outline: true,
                        outlineColor: Cesium.Color.DEEPPINK, // Borde m√°s oscuro
                        outlineWidth: 2,
                        // IMPORTANTE: Al quitar 'height: 0', Cesium lo pega al terreno autom√°ticamente
                    }
                });

                // Punto Central
                viewer.entities.add({
                    position: Cesium.Cartesian3.fromDegrees(lon, lat),
                    point: { 
                        pixelSize: 12, 
                        color: Cesium.Color.WHITE, 
                        outlineColor: Cesium.Color.HOTPINK, 
                        outlineWidth: 3, 
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND 
                    }
                });

                // ============================================================
                // C√ÅMARA MEJORADA (Zoom 2.2 para evitar scroll)
                // ============================================================
                const altura = radio * 3.5; 
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(lon, lat - 0.004, altura),
                    orientation: {
                        heading: Cesium.Math.toRadians(0.0),
                        pitch: Cesium.Math.toRadians(-35.0), // √Ångulo m√°s natural
                        roll: 0.0
                    },
                    duration: 3.5
                });

                console.log("‚úÖ Visualizaci√≥n Rosa corregida");

            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        iniciarCesium();
    </script>
</body>
</html>